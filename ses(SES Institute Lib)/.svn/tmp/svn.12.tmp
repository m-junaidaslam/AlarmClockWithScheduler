/* INCLUDES ******************************************************************/
#include "ses_timer.h"

/* DEFINES & MACROS **********************************************************/
#define TIMER1_CYC_FOR_5MILLISEC  	0x4E2	//TODOs
#define TIMER2_CYC_FOR_1MILLISEC	0xFA	//TODO

#define CTC_MODE_MSK_TIM2			0x02
#define PRESCALER_64_MSK_TIM2	 	0x04

#define CTC_MODE_MSK_TIM1_A			0x00
#define CTC_MODE_MSK_TIM1_B			0x08
#define PRESCALER_64_MSK_TIM1	 	0x03

pTimerCallback timer2CallBack;
pTimerCallback timer1CallBack;

/*FUNCTION DEFINITION ********************************************************/
void timer2_setCallback(pTimerCallback cb) {
	// TODO
	timer2CallBack = cb;
}

void timer2_start() {
	// TODO
	PRR0 &= ~(1 << PRTIM2);

	TCCR2A |= CTC_MODE_MSK_TIM2;
	TCCR2B &= ~(1 << WGM22);
	TCCR2B |= PRESCALER_64_MSK_TIM2;
	TIFR2 |= (1 << OCF2A);
	OCR2A = TIMER2_CYC_FOR_1MILLISEC;
	TIMSK2 |= (1 << OCIE2A);
}

void timer2_stop() {
	// TODO
	PRR0 |= (1 << PRTIM2);
	TIMSK2 &= ~(1 << OCIE2A);
}

void timer1_setCallback(pTimerCallback cb) {
	// TODO
	timer1CallBack = cb;
}

void timer1_start() {
	// TODO
	PRR0 &= ~(1 << PRTIM1);
	TCCR1A |= CTC_MODE_MSK_TIM1_A;
	TCCR1B |= CTC_MODE_MSK_TIM1_B;
	TCCR1B |= PRESCALER_64_MSK_TIM1;
	TIFR1 |= (1 << OCF1A);
	OCR1A = TIMER1_CYC_FOR_5MILLISEC;
	TIMSK1 |= (1 << OCIE1A);
}

void timer1_stop() {
	// TODO
	PRR0 |= (1 << PRTIM1);
	TIMSK1 &= ~(1 << OCIE1A);
}

ISR(TIMER1_COMPA_vect) {
	// TODO
	timer1CallBack();
}

ISR(TIMER2_COMPA_vect) {
	// TODO
	timer2CallBack();
}
